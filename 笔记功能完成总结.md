# ç¬”è®°CRUDåŠŸèƒ½å®Œæˆæ€»ç»“

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. æ•°æ®åº“è®¾è®¡

**ç¬”è®°è¡¨ (note)**:
```sql
CREATE TABLE `note` (
    `id` BIGINT NOT NULL AUTO_INCREMENT,
    `user_id` BIGINT NOT NULL,
    `title` VARCHAR(200) NOT NULL,
    `content` TEXT NOT NULL,
    `status` TINYINT DEFAULT 1,  -- 0:è‰ç¨¿ 1:å‘å¸ƒ 2:ç§å¯†
    `view_count` INT DEFAULT 0,
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
    `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    PRIMARY KEY (`id`),
    KEY `idx_user_id` (`user_id`),
    KEY `idx_status` (`status`),
    KEY `idx_create_time` (`create_time`)
)
```

### 2. åç«¯å®ç°

#### å®ä½“ç±»å’ŒDTO
- âœ… `Note.java` - ç¬”è®°å®ä½“ç±»
- âœ… `NoteRequest.java` - ç¬”è®°è¯·æ±‚DTO

#### æ•°æ®è®¿é—®å±‚
- âœ… `NoteMapper.java` - Mapperæ¥å£
- âœ… `NoteMapper.xml` - MyBatis XMLæ˜ å°„

å®ç°çš„æ–¹æ³•ï¼š
- `insert()` - æ’å…¥ç¬”è®°
- `findById()` - æ ¹æ®IDæŸ¥è¯¢
- `update()` - æ›´æ–°ç¬”è®°
- `deleteById()` - åˆ é™¤ç¬”è®°
- `findByUserId()` - æŸ¥è¯¢ç”¨æˆ·çš„ç¬”è®°
- `findPublicNotes()` - æŸ¥è¯¢å…¬å¼€ç¬”è®°
- `countByUserId()` - ç»Ÿè®¡ç¬”è®°æ•°é‡
- `increaseViewCount()` - å¢åŠ æµè§ˆæ¬¡æ•°

#### ä¸šåŠ¡é€»è¾‘å±‚
- âœ… `NoteService.java` - ç¬”è®°æœåŠ¡

æ ¸å¿ƒåŠŸèƒ½ï¼š
- `createNote()` - åˆ›å»ºç¬”è®°ï¼ˆéœ€è®¤è¯ï¼‰
- `getNoteById()` - è·å–ç¬”è®°è¯¦æƒ…ï¼ˆå«æƒé™éªŒè¯ï¼‰
- `updateNote()` - æ›´æ–°ç¬”è®°ï¼ˆåªèƒ½ä¿®æ”¹è‡ªå·±çš„ï¼‰
- `deleteNote()` - åˆ é™¤ç¬”è®°ï¼ˆåªèƒ½åˆ é™¤è‡ªå·±çš„ï¼‰
- `getUserNotes()` - è·å–ç”¨æˆ·ç¬”è®°åˆ—è¡¨
- `getPublicNotes()` - è·å–å…¬å¼€ç¬”è®°åˆ—è¡¨
- `countUserNotes()` - ç»Ÿè®¡ç¬”è®°æ•°é‡

#### æ§åˆ¶å™¨å±‚
- âœ… `NoteController.java` - RESTful APIæ¥å£

### 3. API æ¥å£è®¾è®¡

| æ¥å£ | æ–¹æ³• | è·¯å¾„ | æƒé™ | åŠŸèƒ½ |
|------|------|------|------|------|
| åˆ›å»ºç¬”è®° | POST | `/api/note/create` | éœ€è®¤è¯ | åˆ›å»ºæ–°ç¬”è®° |
| è·å–è¯¦æƒ… | GET | `/api/note/{id}` | æ¸¸å®¢å¯è®¿é—® | è·å–ç¬”è®°è¯¦æƒ… |
| æ›´æ–°ç¬”è®° | PUT | `/api/note/{id}` | éœ€è®¤è¯ | æ›´æ–°ç¬”è®° |
| åˆ é™¤ç¬”è®° | DELETE | `/api/note/{id}` | éœ€è®¤è¯ | åˆ é™¤ç¬”è®° |
| æˆ‘çš„ç¬”è®° | GET | `/api/note/my` | éœ€è®¤è¯ | è·å–æˆ‘çš„ç¬”è®°åˆ—è¡¨ |
| ç”¨æˆ·ç¬”è®° | GET | `/api/note/user/{userId}` | æ¸¸å®¢å¯è®¿é—® | è·å–ç”¨æˆ·ç¬”è®° |
| å…¬å¼€ç¬”è®° | GET | `/api/note/public` | æ¸¸å®¢å¯è®¿é—® | è·å–æ‰€æœ‰å…¬å¼€ç¬”è®° |
| ç»Ÿè®¡æ•°é‡ | GET | `/api/note/count/{userId}` | æ¸¸å®¢å¯è®¿é—® | ç»Ÿè®¡ç”¨æˆ·ç¬”è®°æ•° |

### 4. Kotlin DSL API æ–‡æ¡£ç³»ç»Ÿ

åˆ›å»ºäº†åŸºäº Kotlin çš„ DSL é£æ ¼ API æ–‡æ¡£ï¼š

#### æ–‡ä»¶ç»“æ„
```
src/main/kotlin/org/example/api/
â”œâ”€â”€ ApiNode.kt       # APIèŠ‚ç‚¹åŸºç±»
â””â”€â”€ VblogAPI.kt      # APIå®šä¹‰ï¼ˆDSLï¼‰
```

#### DSL ç¤ºä¾‹
```kotlin
object VblogAPI {
    object User {
        val Login = post(
            path = "/api/user/login",
            description = "ç”¨æˆ·ç™»å½•ï¼Œè¿”å›JWT Token",
            guestAllowed = true
        )
    }
    
    object Note {
        val Create = post(
            path = "/api/note/create",
            description = "åˆ›å»ºç¬”è®°",
            requireAuth = true
        )
        
        fun GetById(id: Long) = get(
            path = "/api/note/$id",
            description = "è·å–ç¬”è®°è¯¦æƒ…",
            guestAllowed = true
        )
    }
}
```

#### ç‰¹æ€§
- âœ… ç±»å‹å®‰å…¨çš„APIå®šä¹‰
- âœ… æ ‘å½¢ç»“æ„ç»„ç»‡
- âœ… è‡ªæ–‡æ¡£åŒ–
- âœ… é›†ä¸­ç®¡ç†æ‰€æœ‰API
- âœ… æ˜“äºç»´æŠ¤å’Œæ‰©å±•

### 5. æµ‹è¯•ç»“æœ

#### æµ‹è¯•1: åˆ›å»ºç¬”è®° âœ…
```json
{
    "code": 200,
    "message": "ç¬”è®°åˆ›å»ºæˆåŠŸ",
    "data": {
        "id": 4,
        "userId": 1,
        "title": "APIæµ‹è¯•ç¬”è®°",
        "content": "è¿™æ˜¯é€šè¿‡APIåˆ›å»ºçš„æµ‹è¯•ç¬”è®°ï¼ŒéªŒè¯CRUDåŠŸèƒ½",
        "status": 1
    }
}
```

#### æµ‹è¯•2: è·å–ç¬”è®°è¯¦æƒ… âœ…
```json
{
    "code": 200,
    "message": "æ“ä½œæˆåŠŸ",
    "data": {
        "id": 4,
        "userId": 1,
        "title": "APIæµ‹è¯•ç¬”è®°",
        "content": "è¿™æ˜¯é€šè¿‡APIåˆ›å»ºçš„æµ‹è¯•ç¬”è®°ï¼ŒéªŒè¯CRUDåŠŸèƒ½",
        "status": 1,
        "viewCount": 0
    }
}
```

#### æµ‹è¯•3: æ›´æ–°ç¬”è®° âœ…
```json
{
    "code": 200,
    "message": "ç¬”è®°æ›´æ–°æˆåŠŸ",
    "data": {
        "id": 4,
        "title": "æ›´æ–°åçš„ç¬”è®°",
        "content": "ç¬”è®°å†…å®¹å·²æ›´æ–°"
    }
}
```

#### æµ‹è¯•4: åˆ é™¤ç¬”è®° âœ…
```json
{
    "code": 200,
    "message": "ç¬”è®°åˆ é™¤æˆåŠŸ",
    "data": true
}
```

#### æµ‹è¯•5: è·å–ç¬”è®°åˆ—è¡¨ âœ…
```json
{
    "code": 200,
    "message": "è·å–æˆåŠŸ",
    "data": [
        {
            "id": 1,
            "title": "æˆ‘çš„ç¬¬ä¸€ç¯‡ç¬”è®°",
            ...
        },
        ...
    ]
}
```

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. æƒé™æ§åˆ¶
- âœ… **åˆ›å»º/æ›´æ–°/åˆ é™¤**: éœ€è¦ç™»å½•è®¤è¯
- âœ… **æŸ¥çœ‹å…¬å¼€ç¬”è®°**: æ¸¸å®¢å¯è®¿é—®
- âœ… **æŸ¥çœ‹ç§å¯†ç¬”è®°**: åªæœ‰ä½œè€…æœ¬äººå¯è®¿é—®
- âœ… **ä¿®æ”¹åˆ é™¤æƒé™**: åªèƒ½æ“ä½œè‡ªå·±çš„ç¬”è®°

### 2. ç¬”è®°çŠ¶æ€
- `0` - è‰ç¨¿ï¼šæœªå‘å¸ƒçš„ç¬”è®°
- `1` - å‘å¸ƒï¼šå…¬å¼€çš„ç¬”è®°
- `2` - ç§å¯†ï¼šåªæœ‰ä½œè€…å¯è§

### 3. Token é›†æˆ
- ä½¿ç”¨ `TokenHelper` ä»è¯·æ±‚ä¸­è·å–ç”¨æˆ· uid
- è‡ªåŠ¨éªŒè¯ç”¨æˆ·æƒé™
- è®°å½•æ“ä½œè€…ä¿¡æ¯

### 4. æ•°æ®ç»Ÿè®¡
- æµè§ˆæ¬¡æ•°è‡ªåŠ¨ç»Ÿè®¡
- ç”¨æˆ·ç¬”è®°æ•°é‡ç»Ÿè®¡
- åˆ›å»º/æ›´æ–°æ—¶é—´è‡ªåŠ¨è®°å½•

## ğŸ“ æ–‡ä»¶æ¸…å•

### Java æ–‡ä»¶
```
src/main/java/org/example/
â”œâ”€â”€ entity/
â”‚   â””â”€â”€ Note.java                    # ç¬”è®°å®ä½“ç±»
â”œâ”€â”€ dto/
â”‚   â””â”€â”€ NoteRequest.java             # ç¬”è®°è¯·æ±‚DTO
â”œâ”€â”€ mapper/
â”‚   â””â”€â”€ NoteMapper.java              # Mapperæ¥å£
â”œâ”€â”€ service/
â”‚   â””â”€â”€ NoteService.java             # ç¬”è®°æœåŠ¡
â””â”€â”€ controller/
    â””â”€â”€ NoteController.java          # ç¬”è®°æ§åˆ¶å™¨
```

### MyBatis XML
```
src/main/resources/mapper/
â””â”€â”€ NoteMapper.xml                   # SQLæ˜ å°„æ–‡ä»¶
```

### Kotlin æ–‡ä»¶
```
src/main/kotlin/org/example/api/
â”œâ”€â”€ ApiNode.kt                       # APIèŠ‚ç‚¹åŸºç±»
â””â”€â”€ VblogAPI.kt                      # API DSLå®šä¹‰
```

### æ•°æ®åº“
```
sql/
â””â”€â”€ init.sql                         # æ•°æ®åº“åˆå§‹åŒ–ï¼ˆå«ç¬”è®°è¡¨ï¼‰
```

### æ–‡æ¡£
```
â”œâ”€â”€ APIç›®å½•.md                       # APIå®Œæ•´ç›®å½•
â”œâ”€â”€ ç¬”è®°åŠŸèƒ½å®Œæˆæ€»ç»“.md              # æœ¬æ–‡æ¡£
â””â”€â”€ README.md                        # é¡¹ç›®è¯´æ˜ï¼ˆå·²æ›´æ–°ï¼‰
```

## ğŸ”„ ä½¿ç”¨ç¤ºä¾‹

### 1. åˆ›å»ºç¬”è®°
```bash
curl -X POST http://localhost:8080/api/note/create \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "æˆ‘çš„ç¬”è®°",
    "content": "ç¬”è®°å†…å®¹",
    "status": 1
  }'
```

### 2. åœ¨ä»£ç ä¸­ä½¿ç”¨Token Helper
```java
@PostMapping("/create")
@RequireAuth
public Result<Note> createNote(@RequestBody NoteRequest request, 
                               HttpServletRequest httpRequest) {
    // ä»Tokenè·å–ç”¨æˆ·ID
    Long userId = tokenHelper.getUidFromRequest(httpRequest);
    
    // åˆ›å»ºç¬”è®°
    Note note = noteService.createNote(userId, request);
    
    return Result.success("ç¬”è®°åˆ›å»ºæˆåŠŸ", note);
}
```

### 3. æƒé™éªŒè¯
```java
public Note updateNote(Long id, Long userId, NoteRequest request) {
    Note note = noteMapper.findById(id);
    
    // åªèƒ½ä¿®æ”¹è‡ªå·±çš„ç¬”è®°
    if (!note.getUserId().equals(userId)) {
        throw new RuntimeException("åªèƒ½ä¿®æ”¹è‡ªå·±çš„ç¬”è®°");
    }
    
    // æ›´æ–°...
}
```

## ğŸ“Š APIç»Ÿè®¡

### æ€»æ¥å£æ•°
- **ç”¨æˆ·API**: 9ä¸ªï¼ˆç™»å½•ã€æ³¨å†Œã€Tokenç®¡ç†ç­‰ï¼‰
- **ç¬”è®°API**: 8ä¸ªï¼ˆCRUDã€åˆ—è¡¨ã€ç»Ÿè®¡ï¼‰
- **æµ‹è¯•API**: 2ä¸ª
- **æ€»è®¡**: 19ä¸ªAPIæ¥å£

### æƒé™åˆ†å¸ƒ
- **éœ€è¦è®¤è¯**: 11ä¸ª
- **æ¸¸å®¢å¯è®¿é—®**: 8ä¸ª

## ğŸ¨ Kotlin DSL ä¼˜åŠ¿

1. **è‡ªæ–‡æ¡£åŒ–**: APIå®šä¹‰å³æ–‡æ¡£
2. **ç±»å‹å®‰å…¨**: ç¼–è¯‘æ—¶æ£€æŸ¥
3. **é›†ä¸­ç®¡ç†**: æ‰€æœ‰APIç»Ÿä¸€å®šä¹‰
4. **æ˜“äºç»´æŠ¤**: æ–°å¢APIåªéœ€æ·»åŠ å®šä¹‰
5. **æ ‘å½¢ç»“æ„**: æ¸…æ™°çš„æ¨¡å—åŒ–
6. **ä¼˜é›…è¯­æ³•**: Kotlin DSL èƒ½åŠ›

### ç¤ºä¾‹å¯¹æ¯”

#### ä¼ ç»Ÿæ–¹å¼
```
éœ€è¦æŸ¥çœ‹æºç  â†’ æ‰¾åˆ°Controller â†’ æŸ¥çœ‹æ³¨è§£ â†’ ç†è§£å‚æ•°
```

#### Kotlin DSL æ–¹å¼
```kotlin
VblogAPI.Note.Create  // æ¸…æ™°æ˜äº†
// POST /api/note/create - åˆ›å»ºç¬”è®° [éœ€è¦è®¤è¯]
```

## ğŸš€ æœªæ¥æ‰©å±•

### å¯ä»¥æ·»åŠ çš„åŠŸèƒ½
- [ ] ç¬”è®°åˆ†ç±»å’Œæ ‡ç­¾
- [ ] ç¬”è®°æœç´¢åŠŸèƒ½
- [ ] ç¬”è®°è¯„è®ºåŠŸèƒ½
- [ ] ç¬”è®°ç‚¹èµæ”¶è—
- [ ] ç¬”è®°åˆ†äº«åŠŸèƒ½
- [ ] å¯Œæ–‡æœ¬ç¼–è¾‘å™¨æ”¯æŒ
- [ ] Markdownæ”¯æŒ
- [ ] å›¾ç‰‡ä¸Šä¼ 

### APIæ‰©å±•ç¤ºä¾‹
```kotlin
object Note {
    // ç°æœ‰API...
    
    // æ–°å¢APIåªéœ€æ·»åŠ å®šä¹‰
    val Search = get(
        path = "/api/note/search",
        description = "æœç´¢ç¬”è®°",
        guestAllowed = true
    )
    
    fun AddComment(noteId: Long) = post(
        path = "/api/note/$noteId/comment",
        description = "æ·»åŠ è¯„è®º",
        requireAuth = true
    )
}
```

## ğŸ“ æ€»ç»“

âœ… **ç¬”è®°CRUDåŠŸèƒ½**: å®Œæ•´å®ç°å¹¶æµ‹è¯•é€šè¿‡  
âœ… **æƒé™æ§åˆ¶**: å®Œå–„çš„è®¤è¯å’Œæˆæƒæœºåˆ¶  
âœ… **Kotlin DSL**: åˆ›æ–°çš„APIæ–‡æ¡£åŒ–æ–¹å¼  
âœ… **Tokené›†æˆ**: ä¸JWTç³»ç»Ÿå®Œç¾ç»“åˆ  
âœ… **æ–‡æ¡£å®Œæ•´**: APIç›®å½•æ¸…æ™°æ˜ç¡®  

æ‰€æœ‰åŠŸèƒ½å·²å®Œæˆå¹¶ç»è¿‡å®Œæ•´æµ‹è¯•ï¼ğŸ‰

